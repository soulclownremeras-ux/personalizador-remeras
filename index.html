<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personalizador SoulClown 2.0</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Bebas+Neue&family=Pacifico&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .font-bebas { font-family: 'Bebas Neue', cursive; }
        .font-pacifico { font-family: 'Pacifico', cursive; }
        .font-inter { font-family: 'Inter', sans-serif; }
        
        /* Ocultar scrollbar en paneles de herramientas */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Estilo para el área de impresión */
        .print-area {
            mask-image: url('data:image/svg+xml;utf8,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><rect x="50" y="50" width="100" height="120" rx="0" /></svg>');
            -webkit-mask-image:  linear-gradient(to bottom, transparent 15%, black 15%, black 85%, transparent 85%), linear-gradient(to right, transparent 20%, black 20%, black 80%, transparent 80%);
            /* Nota: El enmascaramiento complejo es difícil en un solo archivo sin assets externos, 
               usaremos overflow-hidden simple en el div contenedor para simular el área de impresión */
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Componentes de Iconos ---
        const IconShirt = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M20.38 3.46L16 2a4 4 0 0 1-8 0L3.62 3.46a2 2 0 0 0-1.34 2.23l.58 3.47a1 1 0 0 0 .99.84H6v10c0 1.1.9 2 2 2h8a2 2 0 0 0 2-2V10h2.15a1 1 0 0 0 .99-.84l.58-3.47a2 2 0 0 0-1.34-2.23z"/></svg>;
        const IconType = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>;
        const IconImage = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1.1-.9 2-2 2H7c-1.1 0-2-.9-2-2V6"/><path d="M8 6V4c0-1.1.9-2 2-2h4c1.1 0 2 .9 2 2v2"/></svg>;
        const IconEye = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>;
        const IconDownload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const IconMove = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="5 9 2 12 5 15"/><polyline points="9 5 12 2 15 5"/><polyline points="19 9 22 12 19 15"/><polyline points="9 19 12 22 15 19"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="12" y1="2" x2="12" y2="22"/></svg>;

        // --- Datos de Configuración ---
        const SHIRT_COLORS = [
            { name: "Blanco", hex: "#FFFFFF", border: "border-gray-200" },
            { name: "Negro", hex: "#1a1a1a", border: "border-gray-800" },
            { name: "Gris", hex: "#9CA3AF", border: "border-gray-400" },
            { name: "Rojo", hex: "#EF4444", border: "border-red-500" },
            { name: "Azul", hex: "#3B82F6", border: "border-blue-500" },
            { name: "Amarillo", hex: "#EAB308", border: "border-yellow-500" },
            { name: "Verde", hex: "#22C55E", border: "border-green-500" },
            { name: "Violeta", hex: "#8B5CF6", border: "border-purple-500" },
        ];

        const FONTS = [
            { name: "Clásica", family: "font-inter" },
            { name: "Impacto", family: "font-bebas" },
            { name: "Manuscrita", family: "font-pacifico" },
            { name: "Serif", family: "serif" },
        ];

        // --- Componente Principal ---
        function App() {
            // Estados
            const [shirtColor, setShirtColor] = useState(SHIRT_COLORS[0]);
            const [elements, setElements] = useState([]); // { id, type, content, x, y, color, size, font, rotation }
            const [selectedId, setSelectedId] = useState(null);
            const [activeTab, setActiveTab] = useState('color'); // color, text, images
            const [previewMode, setPreviewMode] = useState(false);
            
            // Referencias para drag & drop
            const dragItem = useRef(null);
            const dragStartPos = useRef({ x: 0, y: 0 });

            // Agregar Texto
            const addText = () => {
                const newId = Date.now();
                setElements([...elements, {
                    id: newId,
                    type: 'text',
                    content: 'TU TEXTO',
                    x: 50, // Porcentaje relativo al centro
                    y: 40,
                    color: '#000000',
                    size: 24,
                    font: 'font-bebas',
                    rotation: 0
                }]);
                setSelectedId(newId);
                setActiveTab('edit'); // Cambiar a pestaña de edición
            };

            // Agregar Imagen
            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const newId = Date.now();
                        setElements([...elements, {
                            id: newId,
                            type: 'image',
                            content: event.target.result,
                            x: 50,
                            y: 40,
                            size: 100, // width in px (base)
                            rotation: 0
                        }]);
                        setSelectedId(newId);
                    };
                    reader.readAsDataURL(file);
                }
            };

            // Eliminar elemento
            const deleteElement = (id) => {
                setElements(elements.filter(el => el.id !== id));
                if (selectedId === id) setSelectedId(null);
            };

            // Actualizar propiedades
            const updateElement = (id, prop, value) => {
                setElements(elements.map(el => el.id === id ? { ...el, [prop]: value } : el));
            };

            // Drag Logic Simple
            const handleMouseDown = (e, id) => {
                if (previewMode) return;
                e.stopPropagation();
                setSelectedId(id);
                dragItem.current = id;
                // Guardar posición inicial del mouse
                dragStartPos.current = { x: e.clientX, y: e.clientY };
            };

            const handleMouseMove = (e) => {
                if (!dragItem.current || previewMode) return;

                const deltaX = e.clientX - dragStartPos.current.x;
                const deltaY = e.clientY - dragStartPos.current.y;

                // Actualizar elemento en el estado
                setElements(prev => prev.map(el => {
                    if (el.id === dragItem.current) {
                        // Convertir delta pixels a porcentaje aproximado (ajustar sensibilidad)
                        // Suponiendo un ancho de canvas de aprox 300px
                        return {
                            ...el,
                            x: el.x + (deltaX / 3), 
                            y: el.y + (deltaY / 3)
                        };
                    }
                    return el;
                }));

                dragStartPos.current = { x: e.clientX, y: e.clientY };
            };

            const handleMouseUp = () => {
                dragItem.current = null;
            };

            // Renderizado de elementos en la remera
            const renderElements = () => {
                return elements.map(el => {
                    const isSelected = el.id === selectedId && !previewMode;
                    const style = {
                        position: 'absolute',
                        top: `${el.y}%`,
                        left: `${el.x}%`,
                        transform: `translate(-50%, -50%) rotate(${el.rotation}deg)`,
                        cursor: previewMode ? 'default' : 'move',
                        border: isSelected ? '2px dashed #3B82F6' : '2px solid transparent',
                        padding: '4px',
                        zIndex: 10
                    };

                    if (el.type === 'text') {
                        return (
                            <div 
                                key={el.id} 
                                style={{...style, color: el.color, fontSize: `${el.size}px`}}
                                className={`whitespace-nowrap select-none ${el.font}`}
                                onMouseDown={(e) => handleMouseDown(e, el.id)}
                                onTouchStart={(e) => {
                                    // Soporte táctil básico
                                    dragItem.current = el.id;
                                    dragStartPos.current = { x: e.touches[0].clientX, y: e.touches[0].clientY };
                                    setSelectedId(el.id);
                                }}
                            >
                                {el.content}
                            </div>
                        );
                    } else {
                        return (
                            <div 
                                key={el.id} 
                                style={style}
                                onMouseDown={(e) => handleMouseDown(e, el.id)}
                            >
                                <img 
                                    src={el.content} 
                                    style={{ width: `${el.size}px`, pointerEvents: 'none' }} 
                                    alt="upload" 
                                />
                            </div>
                        );
                    }
                });
            };

            // Elemento seleccionado actual
            const currentEl = elements.find(el => el.id === selectedId);

            return (
                <div className="min-h-screen flex flex-col md:flex-row max-w-7xl mx-auto bg-white shadow-xl overflow-hidden" 
                     onMouseMove={handleMouseMove} 
                     onMouseUp={handleMouseUp}
                     onTouchMove={(e) => {
                         if (!dragItem.current) return;
                         const touch = e.touches[0];
                         const deltaX = touch.clientX - dragStartPos.current.x;
                         const deltaY = touch.clientY - dragStartPos.current.y;
                         setElements(prev => prev.map(el => el.id === dragItem.current ? {...el, x: el.x + (deltaX/3), y: el.y + (deltaY/3)} : el));
                         dragStartPos.current = { x: touch.clientX, y: touch.clientY };
                     }}
                     onTouchEnd={handleMouseUp}
                >
                    
                    {/* --- AREA DE VISUALIZACIÓN (CANVAS) --- */}
                    <div className="flex-1 bg-gray-100 relative flex items-center justify-center p-4 min-h-[50vh]">
                        {/* Botón Preview Flotante */}
                        <button 
                            onClick={() => {
                                setPreviewMode(!previewMode);
                                setSelectedId(null);
                            }}
                            className="absolute top-4 right-4 z-20 bg-white p-2 rounded-full shadow-lg hover:bg-gray-50 transition-colors"
                            title="Vista Previa"
                        >
                            {previewMode ? <IconType className="w-5 h-5 text-gray-600"/> : <IconEye className="w-5 h-5 text-gray-600"/>}
                        </button>

                        <div className="relative w-full max-w-md aspect-[4/5] flex items-center justify-center">
                            
                            {/* SVG de la Remera */}
                            <svg className="w-full h-full drop-shadow-2xl transition-colors duration-300" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg">
                                <g>
                                    <path 
                                        fill={shirtColor.hex}
                                        d="M378.5,64.5c-15.8,18-47.4,17.8-59.6,17.8c-14.8,0-38.6-2.5-51.4-8.7C254,67.1,245.4,64.5,229.5,64.5c-42.6,0-78,1.4-86.8,4.5   c-8.9,3.1-41.6,14-49.8,24.3c-7.2,9-62.8,77.9-62.8,77.9s-7.8,11.2,3.1,22c6.2,6.1,28.8,21.9,28.8,21.9s9.5,6.1,17.9-3.7   c10.4-12.1,38.2-46.6,38.2-46.6s4.5-4.5,7.8,1.1c2.4,4,2.2,217.5,2.2,217.5s-0.3,37.2,33.5,37.2c27.1,0,147,0,172.8,0   c33.8,0,32.4-37.2,32.4-37.2s-0.6-213.5,1.7-217.5c2.4-4.2,7.8-1.1,7.8-1.1s27.9,34.5,38.2,46.6c8.4,9.8,17.9,3.7,17.9,3.7   s22.6-15.8,28.8-21.9c10.9-10.9,3.1-22,3.1-22s-55.6-68.9-62.8-77.9C423.1,81.5,419.5,64.5,378.5,64.5z"
                                    />
                                    {/* Sombra de superposición para dar volumen */}
                                    <path 
                                        fill="black" 
                                        fillOpacity="0.1" 
                                        style={{mixBlendMode: 'multiply'}}
                                        d="M378.5,64.5c-15.8,18-47.4,17.8-59.6,17.8c-14.8,0-38.6-2.5-51.4-8.7C254,67.1,245.4,64.5,229.5,64.5c-42.6,0-78,1.4-86.8,4.5   c-8.9,3.1-41.6,14-49.8,24.3c-7.2,9-62.8,77.9-62.8,77.9s-7.8,11.2,3.1,22c6.2,6.1,28.8,21.9,28.8,21.9s9.5,6.1,17.9-3.7   c10.4-12.1,38.2-46.6,38.2-46.6s4.5-4.5,7.8,1.1c2.4,4,2.2,217.5,2.2,217.5s-0.3,37.2,33.5,37.2c27.1,0,147,0,172.8,0   c33.8,0,32.4-37.2,32.4-37.2s-0.6-213.5,1.7-217.5c2.4-4.2,7.8-1.1,7.8-1.1s27.9,34.5,38.2,46.6c8.4,9.8,17.9,3.7,17.9,3.7   s22.6-15.8,28.8-21.9c10.9-10.9,3.1-22,3.1-22s-55.6-68.9-62.8-77.9C423.1,81.5,419.5,64.5,378.5,64.5z"
                                    />
                                </g>
                            </svg>

                            {/* Área "Imprimible" (Zona segura) */}
                            <div className="absolute top-[20%] left-[28%] w-[44%] h-[60%] overflow-hidden">
                                {renderElements()}
                            </div>
                        </div>

                        {/* Aviso